<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionario de Cálculo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/styles/style.css" rel="stylesheet" type="text/css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/3.21.1/minified.js"></script>
    <script type="text/javascript" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

<div class="container my-5">
    <h2 class="text-center" id="questionTitle">Pregunta</h2>
    <form id="quizForm">
        <div id="answers" class="mt-4">
            <!-- Las respuestas se generarán aquí con JavaScript -->
        </div>
    </form>
    <button type="button" class="btn btn-info mt-3" data-bs-toggle="modal" data-bs-target="#pistaModal">
    Ver pista
</button>

    <div id="hint" class="mt-3 text-success"></div>
</div>

<!-- Modal de la Pista -->
<div class="modal fade" id="pistaModal" tabindex="-1" aria-labelledby="pistaModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="pistaModalLabel">Pista</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <p id="pistaTexto">Aquí aparecerá la pista.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>



<!-- Incluir Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const preguntas = [
        {{#each preguntasc}}
        {
            id: {{this.id}},
            enunciado: `{{{this.enunciado}}}`,
            correcta: `{{{this.correcta}}}`,
            incorrectas: [
                `{{{this.incorrecta1}}}`,
                `{{{this.incorrecta2}}}`,
                `{{{this.incorrecta3}}}`
            ],
            pista: `{{{this.pista}}}`
        }{{#unless @last}},{{/unless}}
        {{/each}}
    ];

    console.log("Preguntas cargadas:", preguntas);

    let currentQuestionIndex = 0;
    let selectedAnswer = null;

    function mostrarPregunta() {
    const preguntaSeleccionada = preguntas[currentQuestionIndex];

    // Mostrar enunciado
    document.getElementById('questionTitle').innerHTML = preguntaSeleccionada.enunciado;

    // Mezclar respuestas
    const respuestas = [preguntaSeleccionada.correcta, ...preguntaSeleccionada.incorrectas];
    respuestas.sort(() => Math.random() - 0.5);

    const answersDiv = document.getElementById('answers');
    answersDiv.innerHTML = '';

    respuestas.forEach(respuesta => {
        const button = document.createElement('button');
        button.className = "btn btn-outline-primary d-block mb-2";
        button.innerHTML = respuesta;

        button.onclick = function() {
            document.querySelectorAll('#answers button').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            selectedAnswer = respuesta;
        };

        answersDiv.appendChild(button);
    });

    // Mostrar pista correctamente
    const pistaTexto = preguntaSeleccionada.pista ? preguntaSeleccionada.pista : "No hay pista disponible.";
    document.getElementById('pistaTexto').innerHTML = pistaTexto;

    // Forzar renderizado de MathJax para ecuaciones
    if (typeof MathJax !== 'undefined') {
        MathJax.typesetPromise();
    }
   }



    document.getElementById('quizForm').addEventListener('submit', function(e) {
        e.preventDefault();
        if (!selectedAnswer) {
            alert('Por favor, selecciona una respuesta.');
            return;
        }

        currentQuestionIndex++;
        if (currentQuestionIndex < preguntas.length) {
            mostrarPregunta();
        } else {
            window.location.href = "/result";
        }
    });

    if (preguntas.length > 0) {
        mostrarPregunta();
    }

    
</script>

<!-- Cargar MathJax para renderizar LaTeX -->
<script async src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>




</body>
</html>
